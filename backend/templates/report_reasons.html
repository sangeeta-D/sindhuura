{% extends "admin_base.html" %}
{% load static %}
{% block content %}

<div class="content-wrapper">
  <div class="container-xxl container-p-y">

    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4 class="fw-bold">Report Reasons</h4>
      <button class="btn btn-primary" onclick="openAddModal()">
        + Add Reason
      </button>
    </div>

    <div class="card">
      <div class="card-body">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Title</th>
              <!-- <th>Description</th> -->
              <th>Status</th>
              <th width="120">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for reason in reasons %}
            <tr>
              <td>
                <strong>{{ reason.title }}</strong>
              </td>
              <!-- <td>
                <small class="text-muted">{{ reason.description|truncatechars:100 }}</small> -->
              <!-- </td> -->
              <td>
                {% if reason.is_active %}
                  <span class="badge bg-success">Active</span>
                {% else %}
                  <span class="badge bg-secondary">Inactive</span>
                {% endif %}
              </td>
              <td>
                <button class="btn btn-sm btn-outline-primary"
                        onclick="openEditModal('{{ reason.id }}','{{ reason.title|escapejs }}','{{ reason.description|escapejs }}','{{ reason.is_active }}')">
                  <i class="bx bx-edit"></i>
                </button>

                <button class="btn btn-sm btn-outline-danger"
                        onclick="deleteReason('{{ reason.id }}')">
                  <i class="bx bx-trash"></i>
                </button>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted">
                No report reasons added
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<!-- ADD / EDIT MODAL -->
<div class="modal fade" id="reasonModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form method="POST" class="modal-content">
      {% csrf_token %}

      <input type="hidden" name="action" id="actionField">
      <input type="hidden" name="reason_id" id="reasonIdField">

      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Add Reason</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body row g-3">

        <div class="col-md-12">
          <label class="form-label">Title</label>
          <input type="text" name="title" id="titleField" class="form-control" required>
        </div>

        <!-- <div class="col-md-12">
          <label class="form-label">Description</label>
          <textarea name="description" id="descriptionField" class="form-control" rows="3"></textarea>
        </div> -->

        <div class="col-md-12">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="is_active" id="isActiveField" checked>
            <label class="form-check-label">Active</label>
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button class="btn btn-primary" type="submit">
          Save
        </button>
      </div>

    </form>
  </div>
</div>

<script>
function openAddModal() {
  document.getElementById("modalTitle").innerText = "Add Reason"
  document.getElementById("actionField").value = "add"
  document.getElementById("reasonIdField").value = ""
  document.getElementById("titleField").value = ""
  
  document.getElementById("isActiveField").checked = true

  new bootstrap.Modal(document.getElementById("reasonModal")).show()
}

function openEditModal(id, title, description, isActive) {
  document.getElementById("modalTitle").innerText = "Edit Reason"
  document.getElementById("actionField").value = "edit"
  document.getElementById("reasonIdField").value = id
  document.getElementById("titleField").value = title
  document.getElementById("isActiveField").checked = isActive === "True"

  new bootstrap.Modal(document.getElementById("reasonModal")).show()
}

function deleteReason(id) {
  if (!confirm("Are you sure you want to delete this reason?")) return

  const form = document.createElement("form")
  form.method = "POST"
  form.innerHTML = `
    {% csrf_token %}
    <input type="hidden" name="action" value="delete">
    <input type="hidden" name="reason_id" value="${id}">
  `
  document.body.appendChild(form)
  form.submit()
}
</script>

{% if messages %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    {% for message in messages %}
      Toastify({
        text: "{{ message|escapejs }}",
        duration: 4000,
        close: true,
        gravity: "top",
        position: "right",
        backgroundColor: "{% if message.tags == 'success' %}#28a745{% elif message.tags == 'error' %}#dc3545{% elif message.tags == 'warning' %}#ffc107{% else %}#0d6efd{% endif %}",
        stopOnFocus: true,
      }).showToast();
    {% endfor %}
  });
</script>
{% endif %}

{% endblock %}